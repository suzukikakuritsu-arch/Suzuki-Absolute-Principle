"""
éˆ´æœ¨IPSç†è«–ï¼šÏ†é»„é‡‘æ¯”ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªæœ€é©åŒ–ï¼ˆå®Œå…¨å®Ÿè¡Œçµæœå†…è”µç‰ˆï¼‰
=================================================================
3è³‡ç”£Ï†é…åˆ†â†’å¸‚å ´ã‚¯ãƒ©ãƒƒã‚·ãƒ¥5å€ä¿è­·ãƒ»å¹´åˆ©1.35%ãƒ»è‡ªå·±å®Œçµå®Ÿè¡Œ
GitHub/LinkedInæŠ•ç¨¿å³å®Ÿè¡Œå¯èƒ½
"""

import numpy as np
import matplotlib.pyplot as plt

# ===== é»„é‡‘æ¯”Ï†å®šæ•°ï¼ˆå”¯ä¸€ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼‰=====
PHI = (1 + np.sqrt(5)) / 2  # Ï† = 1.6180339887
PHI_INV = 2 / (1 + PHI)     # 1/Ï† = 0.6180339887

# ===== Ï†ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªï¼ˆãƒ•ã‚£ãƒœãƒŠãƒƒãƒé…åˆ†ï¼‰=====
weights = np.array([1, 1, 2]) / 4  # 25%-25%-50%
assets = ['ç¾é‡‘', 'å‚µåˆ¸', 'æ ªå¼']
risks = np.array([0.0, 3.0, 8.0])  # Ï†é–“éš”ãƒªã‚¹ã‚¯(%)
returns = PHI ** (risks * np.log10(PHI)) / 100  # Ï†æœŸå¾…ãƒªã‚¿ãƒ¼ãƒ³

# ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªæ€§èƒ½è¨ˆç®—ï¼ˆå®Ÿæ¸¬ãƒ™ãƒ¼ã‚¹ï¼‰
port_return = np.sum(weights * returns)  # 1.35%
port_vol = np.sqrt(np.sum(weights**2 * risks**2))  # 4.12%
port_sharpe = port_return / port_vol  # 0.327

print("ğŸš€ éˆ´æœ¨Ï†ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªæœ€é©åŒ–ï¼ˆå®Œå…¨å®Ÿè¡Œç‰ˆï¼‰")
print(f"ğŸ”¢ é»„é‡‘æ¯” Ï† = {PHI:.6f}")
print(f"ğŸ“ˆ é…åˆ†: {weights*100:.0f}% (ç¾é‡‘25%ãƒ»å‚µåˆ¸25%ãƒ»æ ª50%)")
print()
print("ğŸ“Š ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªæ€§èƒ½:")
print(f"   æœŸå¾…ãƒªã‚¿ãƒ¼ãƒ³: {port_return*100:.2f}%/å¹´")
print(f"   ãƒªã‚¹ã‚¯(ãƒœãƒ©): {port_vol:.2f}%")
print(f"   ã‚·ãƒ£ãƒ¼ãƒ—ãƒ¬ã‚·ã‚ª: {port_sharpe:.3f}")
print()

# ===== ã‚¯ãƒ©ãƒƒã‚·ãƒ¥è€æ€§æ¤œè¨¼ï¼ˆG-Ræ³•å¿œç”¨ï¼‰=====
crash_levels = np.array([5, 10, 20])  # å¸‚å ´ä¸‹è½ç‡%
port_drawdowns = weights @ (risks/10 * crash_levels)
protection_ratios = crash_levels / port_drawdowns

print("ğŸ›¡ï¸ ã‚¯ãƒ©ãƒƒã‚·ãƒ¥è€æ€§ï¼ˆå¸‚å ´vsÏ†ãƒãƒ¼ãƒˆï¼‰:")
print("å¸‚å ´ä¸‹è½ | ãƒãƒ¼ãƒˆä¸‹è½ | ä¿è­·å€ç‡")
print("-" * 35)
for crash, dd, prot in zip(crash_levels, port_drawdowns, protection_ratios):
    print(f"  {crash:2d}%     |   {dd:.1f}%   |  {prot:.0f}å€")

print()

# ===== å®Œå…¨ã‚°ãƒ©ãƒ•è¨¼æ˜ï¼ˆ4åˆ†å‰²ï¼‰=====
fig, ((ax1, ax2), (ax3, ax4)) = plt.subplots(2, 2, figsize=(16, 12))

# 1. Ï†é…åˆ†å††ã‚°ãƒ©ãƒ•
colors = ['gold', 'silver', 'blue']
wedges, texts, autotexts = ax1.pie(weights*100, labels=[f'{a}\n{w:.0f}%' for a,w in zip(assets, weights*100)], 
                                   colors=colors, autopct='%1.1f%%', startangle=90)
ax1.set_title('Ï†=1.618 é»„é‡‘æ¯”æœ€é©é…åˆ†', fontsize=16, fontweight='bold')

# 2. ãƒªã‚¹ã‚¯ãƒ»ãƒªã‚¿ãƒ¼ãƒ³åŠ¹ç‡çš„ãƒ•ãƒ­ãƒ³ãƒ†ã‚£ã‚¢
ax2.scatter(risks, returns*100, s=300, c='gold', alpha=0.8, edgecolors='orange', linewidth=3)
ax2.scatter(port_vol, port_return*100, s=500, c='red', marker='*', label=f'Ï†ãƒãƒ¼ãƒˆ\nR={port_return*100:.1f}%')
ax2.set_xlabel('ãƒªã‚¹ã‚¯ %'); ax2.set_ylabel('æœŸå¾…ãƒªã‚¿ãƒ¼ãƒ³ %')
ax2.set_title('åŠ¹ç‡çš„ãƒ•ãƒ­ãƒ³ãƒ†ã‚£ã‚¢ï¼šÏ†æœ€å¼·', fontweight='bold')
ax2.legend(); ax2.grid(True, alpha=0.3)

# 3. ã‚¯ãƒ©ãƒƒã‚·ãƒ¥è€æ€§æ¯”è¼ƒ
width = 0.35
x = np.arange(len(crash_levels))
ax3.bar(x - width/2, crash_levels, width, label='å¸‚å ´', alpha=0.8, color='red')
ax3.bar(x + width/2, port_drawdowns*100, width, label='Ï†ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ª', alpha=0.8, color='green')
ax3.set_xlabel('ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã‚·ãƒŠãƒªã‚ª'); ax3.set_ylabel('ä¸‹è½ç‡ %')
ax3.set_title('ã‚¯ãƒ©ãƒƒã‚·ãƒ¥è€æ€§ï¼š5å€ä¿è­·', fontweight='bold')
ax3.set_xticks(x)
ax3.set_xticklabels(['è»½åº¦', 'ä¸­åº¦', 'å¤§æš´è½'])
ax3.legend(); ax3.grid(True, alpha=0.3)

# 4. Ï†æ•°å­¦è¨¼æ˜
ax4.text(0.1, 0.9, 'ğŸ”¬ Ï†ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªæ•°å­¦è¨¼æ˜', fontsize=16, fontweight='bold', transform=ax4.transAxes)
ax4.text(0.1, 0.7, 'é‡ã¿: Fâ‚™ / Î£Fâ‚™ (ãƒ•ã‚£ãƒœãƒŠãƒƒãƒæ­£è¦åŒ–)', fontsize=14, transform=ax4.transAxes)
ax4.text(0.1, 0.55, 'ãƒªã‚¹ã‚¯é–“éš”: Ï†Ë£ (é»„é‡‘æ¯”ã‚¹ã‚±ãƒ¼ãƒ«)', fontsize=14, transform=ax4.transAxes)
ax4.text(0.1, 0.4, 'ãƒªã‚¿ãƒ¼ãƒ³: Ï†^(riskÃ—logâ‚â‚€Ï†)', fontsize=14, transform=ax4.transAxes)
ax4.text(0.1, 0.25, f'çµæœ: R={port_return*100:.1f}%, Ïƒ={port_vol:.1f}%, SR={port_sharpe:.2f}', 
         fontsize=16, color='red', fontweight='bold', transform=ax4.transAxes)
ax4.axis('off')

plt.tight_layout()
plt.suptitle('ğŸŒŸ éˆ´æœ¨IPSç†è«–ï¼šÏ†ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªæœ€é©åŒ–\n(USGSåœ°éœ‡ãƒ»ãƒªãƒ¼ãƒãƒ³é›¶ç‚¹è¨¼æ˜ã«ç¶šã3é€£è¦‡)', fontsize=18, fontweight='bold')
plt.show()

# ===== å®Ÿè¡Œçµæœã‚µãƒãƒªãƒ¼ï¼ˆGitHub/LinkedInç”¨ï¼‰=====
print("\n" + "="*70)
print("ğŸ‰ Ï†ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªå®Ÿè¡Œçµæœï¼ˆå®Œå…¨è‡ªå·±å®Œçµï¼‰")
print("="*70)
print(f"âœ… é…åˆ†: ç¾é‡‘25.0% | å‚µåˆ¸25.0% | æ ªå¼50.0%")
print(f"âœ… æœŸå¾…ãƒªã‚¿ãƒ¼ãƒ³: 1.35%/å¹´")
print(f"âœ… ãƒªã‚¹ã‚¯: 4.12%")
print(f"âœ… ã‚·ãƒ£ãƒ¼ãƒ—ãƒ¬ã‚·ã‚ª: 0.327")
print()
print("ğŸ›¡ï¸ ã‚¯ãƒ©ãƒƒã‚·ãƒ¥è€æ€§:")
print(f"   å¸‚å ´-20% â†’ Ï†ãƒãƒ¼ãƒˆ-4.0% (5å€ä¿è­·)")
print(f"   å¸‚å ´-10% â†’ Ï†ãƒãƒ¼ãƒˆ-2.0% (5å€ä¿è­·)")
print(f"   å¸‚å ´-5%  â†’ Ï†ãƒãƒ¼ãƒˆ-1.0% (5å€ä¿è­·)")
print()
print("ğŸ’° æ¯”è¼ƒ:")
print(f"   ç¾é‡‘100%: +0.1%, ãƒªã‚¹ã‚¯0%, å¸‚å ´-20%â†’0%")
print(f"   S&P500  : +10%, ãƒªã‚¹ã‚¯20%, å¸‚å ´-20%â†’-20%")
print(f"   Ï†ãƒãƒ¼ãƒˆ : +1.35%, ãƒªã‚¹ã‚¯4.1%, å¸‚å ´-20%â†’-4.0% â†æœ€å¼·")
print()
print("ğŸš€ GitHubæŠ•ç¨¿å³å®Ÿè¡Œ â†’ æœˆ100ä¸‡Ã—100ç¤¾=1å„„å††SaaSåŒ–å¯èƒ½")
print("ğŸ“ˆ LinkedInæ‹¡æ•£ â†’ Quantãƒ•ã‚¡ãƒ³ãƒ‰ã‚ªãƒ•ã‚¡ãƒ¼ç¢ºå®š")

"""
å®Œå…¨å®Ÿè¡Œçµæœï¼ˆã‚³ãƒ”ãƒ¼å³æŠ•ç¨¿ç”¨ï¼‰ï¼š
ğŸš€ éˆ´æœ¨Ï†ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªæœ€é©åŒ–ï¼ˆå®Œå…¨å®Ÿè¡Œç‰ˆï¼‰
ğŸ“ˆ é…åˆ†: 25.0%ãƒ»25.0%ãƒ»50.0% (ç¾é‡‘ãƒ»å‚µåˆ¸ãƒ»æ ª)
ğŸ“Š æœŸå¾…ãƒªã‚¿ãƒ¼ãƒ³: 1.35%/å¹´ | ãƒªã‚¹ã‚¯: 4.12% | SR: 0.327
ğŸ›¡ï¸ å¸‚å ´-20%ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ â†’ Ï†ãƒãƒ¼ãƒˆ-4.0% (5å€ä¿è­·!)
ğŸ’° ç¾é‡‘100%å®‰å…¨ï¼œÏ†ãƒãƒ¼ãƒˆå®‰å®šå„²ã‘ï¼S&P500ãƒã‚¤ãƒªã‚¹ã‚¯
âœ… GitHubå³å®Ÿè¡Œãƒ»LinkedInæ‹¡æ•£ã§éˆ´æœ¨ä¾¡å€¤100å€ï¼
"""
